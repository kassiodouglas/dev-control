<div class="relative z-10 flex flex-col h-full overflow-hidden transition-colors duration-300 bg-white border-r border-zinc-200 dark:bg-zinc-900 dark:border-zinc-800">
  <!-- Header -->
  <div
    class="p-6 border-b border-zinc-200 dark:border-zinc-800 flex items-center shrink-0 h-[89px]"
    [class.justify-between]="!appService.sidebarCollapsed()"
    [class.justify-center]="appService.sidebarCollapsed()"
  >
    @if (!appService.sidebarCollapsed()) {
      <div class="flex items-center gap-3 overflow-hidden cursor-pointer" (click)="goToDashboard()">
        <div class="flex items-center justify-center w-8 h-8 font-bold text-white bg-indigo-600 rounded-lg shadow-md shadow-indigo-200 dark:shadow-none shrink-0">
          <i class="fa-solid fa-code"></i>
        </div>
        <span class="text-lg font-bold tracking-tight text-zinc-800 dark:text-white whitespace-nowrap">DevControl</span>
      </div>
    } @else {
       <div (click)="goToDashboard()" class="flex items-center justify-center w-8 h-8 font-bold text-white transition-colors bg-indigo-600 rounded-lg shadow-md cursor-pointer hover:bg-indigo-700">
          <i class="fa-solid fa-code"></i>
       </div>
    }

    @if (!appService.sidebarCollapsed()) {
      <button (click)="appService.toggleSidebar()" class="transition-colors text-zinc-400 hover:text-indigo-600 dark:hover:text-indigo-400">
        <i class="fa-solid fa-angles-left"></i>
      </button>
    }
  </div>

  <!-- Add New Button -->
  <div class="flex justify-center p-4 shrink-0">
    <button
      (click)="isModalOpen.set(true)"
      class="flex items-center justify-center font-medium text-white transition-colors bg-indigo-600 rounded-md shadow-lg hover:bg-indigo-700 shadow-indigo-600/20"
      [class.w-full]="!appService.sidebarCollapsed()"
      [class.py-2]="!appService.sidebarCollapsed()"
      [class.px-4]="!appService.sidebarCollapsed()"
      [class.gap-2]="!appService.sidebarCollapsed()"
      [class.w-10]="appService.sidebarCollapsed()"
      [class.h-10]="appService.sidebarCollapsed()"
      [class.rounded-lg]="appService.sidebarCollapsed()"
      title="New Project"
    >
      <i class="fa-solid fa-plus"></i>
      @if (!appService.sidebarCollapsed()) {
        <span>New Project</span>
      }
    </button>
  </div>

  <!-- Main Navigation -->
  <div class="px-2 mb-4 space-y-1 shrink-0">
     <div
        (click)="goToDashboard()"
        class="flex items-center gap-3 p-2 transition-colors rounded-md cursor-pointer"
        [class.justify-center]="appService.sidebarCollapsed()"
        [class.bg-zinc-100]="appService.activeView() === 'dashboard'"
        [class.dark:bg-zinc-800]="appService.activeView() === 'dashboard'"
        [class.text-indigo-600]="appService.activeView() === 'dashboard'"
        [class.dark:text-indigo-400]="appService.activeView() === 'dashboard'"
        [class.text-zinc-600]="appService.activeView() !== 'dashboard'"
        [class.dark:text-zinc-400]="appService.activeView() !== 'dashboard'"
        [class.hover:bg-zinc-50]="appService.activeView() !== 'dashboard'"
        [class.dark:hover:bg-zinc-800]="appService.activeView() !== 'dashboard'"
        title="Dashboard"
     >
       <i class="w-5 text-center fa-solid fa-chart-pie"></i>
       @if (!appService.sidebarCollapsed()) {
         <span class="text-sm font-medium whitespace-nowrap">Dashboard</span>
       }
     </div>
     <div
        (click)="goToAzure()"
        class="flex items-center gap-3 p-2 transition-colors rounded-md cursor-pointer"
        [class.justify-center]="appService.sidebarCollapsed()"
        [class.bg-zinc-100]="appService.activeView() === 'azure-boards'"
        [class.dark:bg-zinc-800]="appService.activeView() === 'azure-boards'"
        [class.text-indigo-600]="appService.activeView() === 'azure-boards'"
        [class.dark:text-indigo-400]="appService.activeView() === 'azure-boards'"
        [class.text-zinc-600]="appService.activeView() !== 'azure-boards'"
        [class.dark:text-zinc-400]="appService.activeView() !== 'azure-boards'"
        [class.hover:bg-zinc-50]="appService.activeView() !== 'azure-boards'"
        [class.dark:hover:bg-zinc-800]="appService.activeView() !== 'azure-boards'"
        title="Azure Boards"
     >
       <i class="w-5 text-center fa-brands fa-microsoft"></i>
       @if (!appService.sidebarCollapsed()) {
         <span class="text-sm font-medium whitespace-nowrap">Azure Boards</span>
       }
     </div>
     <div
        (click)="goToNotes()"
        class="flex items-center gap-3 p-2 transition-colors rounded-md cursor-pointer"
        [class.justify-center]="appService.sidebarCollapsed()"
        [class.bg-zinc-100]="appService.activeView() === 'notes'"
        [class.dark:bg-zinc-800]="appService.activeView() === 'notes'"
        [class.text-indigo-600]="appService.activeView() === 'notes'"
        [class.dark:text-indigo-400]="appService.activeView() === 'notes'"
        [class.text-zinc-600]="appService.activeView() !== 'notes'"
        [class.dark:text-zinc-400]="appService.activeView() !== 'notes'"
        [class.hover:bg-zinc-50]="appService.activeView() !== 'notes'"
        [class.dark:hover:bg-zinc-800]="appService.activeView() !== 'notes'"
        title="Global Notes"
     >
       <i class="w-5 text-center fa-solid fa-note-sticky"></i>
       @if (!appService.sidebarCollapsed()) {
         <span class="text-sm font-medium whitespace-nowrap">Global Notes</span>
       }
     </div>
     <div
        (click)="goToSettings()"
        class="flex items-center gap-3 p-2 transition-colors rounded-md cursor-pointer"
        [class.justify-center]="appService.sidebarCollapsed()"
        [class.bg-zinc-100]="appService.activeView() === 'settings'"
        [class.dark:bg-zinc-800]="appService.activeView() === 'settings'"
        [class.text-indigo-600]="appService.activeView() === 'settings'"
        [class.dark:text-indigo-400]="appService.activeView() === 'settings'"
        [class.text-zinc-600]="appService.activeView() !== 'settings'"
        [class.dark:text-zinc-400]="appService.activeView() !== 'settings'"
        [class.hover:bg-zinc-50]="appService.activeView() !== 'settings'"
        [class.dark:hover:bg-zinc-800]="appService.activeView() !== 'settings'"
        title="Settings"
     >
       <i class="w-5 text-center fa-solid fa-gear"></i>
       @if (!appService.sidebarCollapsed()) {
         <span class="text-sm font-medium whitespace-nowrap">Settings</span>
       }
     </div>
  </div>

  <!-- App List -->
  <div class="flex-1 px-2 py-2 space-y-1 overflow-y-auto border-t custom-scrollbar border-zinc-200 dark:border-zinc-800">
    @if (!appService.sidebarCollapsed()) {
      <div class="px-2 mt-4 mb-2 text-xs font-bold tracking-wider uppercase text-zinc-400 dark:text-zinc-500 whitespace-nowrap">Repositories</div>
    } @else {
       <div class="h-4 mt-4"></div>
    }

    @for (app of appService.apps(); track app.id) {
      <div
        (click)="selectApp(app.id)"
        class="flex items-center gap-3 p-2 transition-all duration-200 rounded-md cursor-pointer group"
        [class.justify-center]="appService.sidebarCollapsed()"
        [class.bg-zinc-100]="appService.selectedAppId() === app.id"
        [class.dark:bg-zinc-800]="appService.selectedAppId() === app.id"
        [class.text-indigo-600]="appService.selectedAppId() === app.id"
        [class.dark:text-indigo-400]="appService.selectedAppId() === app.id"
        [class.text-zinc-600]="appService.selectedAppId() !== app.id"
        [class.dark:text-zinc-400]="appService.selectedAppId() !== app.id"
        [class.hover:bg-zinc-50]="appService.selectedAppId() !== app.id"
        [class.dark:hover:bg-zinc-800]="appService.selectedAppId() !== 'running'"
        [attr.title]="app.name"
      >
        <div class="w-2.5 h-2.5 rounded-full shrink-0"
          [class.bg-green-500]="app.status === 'running'"
          [class.bg-zinc-400]="app.status !== 'running'"
          [class.ring-2]="appService.sidebarCollapsed() && app.status === 'running'"
          [class.ring-green-500]="appService.sidebarCollapsed() && app.status === 'running'"
          [class.ring-opacity-30]="appService.sidebarCollapsed() && app.status === 'running'"
        ></div>

        @if (!appService.sidebarCollapsed()) {
          <div class="flex-1 min-w-0">
            <div class="text-sm font-medium truncate">{{ app.name }}</div>
            <div class="text-[10px] text-zinc-400 dark:text-zinc-500 truncate group-hover:text-zinc-500 dark:group-hover:text-zinc-400 font-mono">{{ app.host }}:{{ app.port }}</div>
          </div>
          @if (app.status === 'running') {
            <i class="text-xs text-yellow-500 fa-solid fa-bolt animate-pulse"></i>
          }
        }
      </div>
    }
  </div>

  <!-- Footer User -->
  <div class="relative flex flex-col gap-3 p-4 border-t border-zinc-200 dark:border-zinc-800 shrink-0">
    @if (!appService.sidebarCollapsed()) {
      <div class="flex items-center justify-between">
        <span class="text-xs font-semibold text-zinc-500 dark:text-zinc-400">Theme</span>
        <button (click)="appService.toggleTheme()" class="transition-colors text-zinc-500 hover:text-indigo-600 dark:text-zinc-400 dark:hover:text-indigo-400">
          @if(appService.darkMode()) {
            <i class="fa-solid fa-sun"></i>
          } @else {
            <i class="fa-solid fa-moon"></i>
          }
        </button>
      </div>
    }

    <div class="flex items-center gap-3" [class.justify-center]="appService.sidebarCollapsed()">
      <img [src]="appService.userProfile().avatarUrl" class="object-cover w-8 h-8 rounded-full bg-zinc-200 dark:bg-zinc-700 shrink-0">

      @if (!appService.sidebarCollapsed()) {
        <div class="flex-1 min-w-0">
          <div class="text-xs font-bold truncate text-zinc-700 dark:text-zinc-300">{{ appService.userProfile().name }}</div>
          <div class="text-[10px] text-zinc-500 dark:text-zinc-500 truncate">Local Environment</div>
        </div>
        @if (appService.security().isEnabled) {
          <button (click)="appService.lockApp()" class="transition-colors text-zinc-400 hover:text-red-500" title="Lock App">
            <i class="fa-solid fa-lock"></i>
          </button>
        }
      } @else {
         <!-- Collapsed Actions -->
         @if (appService.sidebarCollapsed()) {
            <button (click)="appService.toggleSidebar()" class="absolute z-10 flex items-center justify-center w-8 h-8 transition-colors -translate-x-1/2 bg-white border rounded-full shadow-md bottom-20 left-1/2 text-zinc-400 hover:text-indigo-600 dark:hover:text-indigo-400 dark:bg-zinc-900 border-zinc-200 dark:border-zinc-700">
               <i class="fa-solid fa-angles-right"></i>
            </button>
         }
      }
    </div>
  </div>
</div>

<!-- Create App Modal -->
@if (isModalOpen()) {
  <div class="fixed inset-0 z-50 flex items-center justify-center p-4 duration-200 bg-black/50 backdrop-blur-sm animate-in fade-in">
    <div class="w-full max-w-lg overflow-hidden duration-200 scale-100 bg-white border shadow-2xl dark:bg-zinc-900 rounded-xl animate-in zoom-in-95 border-zinc-200 dark:border-zinc-700">

      <!-- Modal Header -->
      <div class="flex items-center justify-between px-6 py-4 border-b bg-zinc-50 dark:bg-zinc-950 border-zinc-200 dark:border-zinc-800">
             <h3 class="text-lg font-bold text-zinc-800 dark:text-white">New Local Project</h3>
             <button (click)="isModalOpen.set(false)" class="text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200">
               <i class="text-lg fa-solid fa-xmark"></i>
             </button>
          </div>

          <!-- Modal Body -->
          <div class="p-6 space-y-4">
            <div class="space-y-1.5">
              <label class="text-sm font-semibold text-zinc-700 dark:text-zinc-300">Project Name</label>
              <input type="text" [(ngModel)]="newAppName" placeholder="e.g. My Awesome App" class="w-full px-3 py-2 text-sm bg-white border rounded-lg dark:bg-zinc-950 border-zinc-300 dark:border-zinc-700 text-zinc-800 dark:text-white focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
            </div>

            <div class="space-y-1.5">
              <label class="text-sm font-semibold text-zinc-700 dark:text-zinc-300">Local Path</label>
              <div class="flex gap-2">
                 <input type="text" [(ngModel)]="newAppPath" placeholder="C:\Projects\MyApp" class="flex-1 px-3 py-2 text-sm bg-white border rounded-lg dark:bg-zinc-950 border-zinc-300 dark:border-zinc-700 text-zinc-800 dark:text-white focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
                 <button class="px-3 py-2 border rounded-lg border-zinc-300 dark:border-zinc-700 text-zinc-500 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-800">
                    <i class="fa-solid fa-folder-open"></i>
                 </button>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="space-y-1.5">
                <label class="text-sm font-semibold text-zinc-700 dark:text-zinc-300">Host</label>
                <input type="text" [(ngModel)]="newAppHost" placeholder="localhost" class="w-full px-3 py-2 text-sm bg-white border rounded-lg dark:bg-zinc-950 border-zinc-300 dark:border-zinc-700 text-zinc-800 dark:text-white focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
              </div>
              <div class="space-y-1.5">
                <label class="text-sm font-semibold text-zinc-700 dark:text-zinc-300">Port</label>
                <input type="number" [(ngModel)]="newAppPort" placeholder="4200" class="w-full px-3 py-2 text-sm bg-white border rounded-lg dark:bg-zinc-950 border-zinc-300 dark:border-zinc-700 text-zinc-800 dark:text-white focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
              </div>
            </div>

            <div class="space-y-1.5">
              <label class="text-sm font-semibold text-zinc-700 dark:text-zinc-300">Start Command</label>
              <div class="relative">
                <span class="absolute font-mono text-sm left-3 top-2 text-zinc-500 dark:text-zinc-400">$</span>
                <input type="text" [(ngModel)]="newAppStartCmd" placeholder="npm start" class="w-full py-2 pl-6 pr-3 font-mono text-sm bg-white border rounded-lg dark:bg-zinc-950 border-zinc-300 dark:border-zinc-700 text-zinc-800 dark:text-white focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
              </div>
            </div>
          </div>

          <!-- Modal Footer -->
          <div class="flex justify-end gap-3 px-6 py-4 border-t bg-zinc-50 dark:bg-zinc-950 border-zinc-200 dark:border-zinc-800">
             <button (click)="isModalOpen.set(false)" class="px-4 py-2 text-sm font-medium transition-colors text-zinc-600 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-white">Cancel</button>
             <button (click)="createApp()" [disabled]="!newAppName || !newAppPath" class="px-4 py-2 text-sm font-bold text-white transition-colors bg-indigo-600 rounded-lg shadow-sm hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed">
               <i class="mr-1 fa-solid fa-plus"></i> Create Project
             </button>
          </div>
        </div>
      </div>
    }
